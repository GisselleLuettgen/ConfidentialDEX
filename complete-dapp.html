<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>隐私DeFi平台 - Privacy DEX & FundPad</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298, #1a237e);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }

        .wallet-status {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .input-group input::placeholder, .input-group textarea::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .project-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .trading-pair {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: white;
        }

        .close:hover {
            color: #ff6b6b;
        }

        .status-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background: #4caf50;
        }

        .status-completed {
            background: #2196f3;
        }

        .status-failed {
            background: #f44336;
        }

        .flex-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .error {
            color: #ff6b6b;
            margin-top: 10px;
        }

        .success {
            color: #4caf50;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .wallet-status {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔐 隐私DeFi平台</h1>
            <p>基于Zama FHE的隐私保护去中心化金融平台</p>
        </div>

        <div class="wallet-status">
            <div>
                <span id="wallet-status">未连接钱包</span>
                <div id="wallet-info" style="display:none;">
                    <div>地址: <span id="wallet-address"></span></div>
                    <div>余额: <span id="wallet-balance"></span> ETH</div>
                    <div>网络: <span id="network-info"></span></div>
                </div>
            </div>
            <button id="connect-wallet" class="btn">连接MetaMask</button>
        </div>

        <div class="navigation">
            <button class="nav-btn active" onclick="showPage('home')">首页</button>
            <button class="nav-btn" onclick="showPage('fundpad')">筹款平台</button>
            <button class="nav-btn" onclick="showPage('dex')">隐私DEX</button>
        </div>

        <!-- 首页 -->
        <div id="home" class="page active">
            <div class="card">
                <h2>欢迎来到隐私DeFi平台</h2>
                <p>这是一个基于Zama FHE技术的隐私保护DeFi平台，提供以下功能：</p>
                <ul style="margin: 20px 0; padding-left: 20px;">
                    <li><strong>隐私筹款平台(FundPad)</strong>: 创建和投资隐私保护的筹款项目</li>
                    <li><strong>隐私DEX</strong>: 进行隐私保护的代币交易</li>
                    <li><strong>MetaMask集成</strong>: 无缝的钱包连接和交易体验</li>
                </ul>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="showPage('fundpad')">开始筹款</button>
                    <button class="btn" onclick="showPage('dex')">开始交易</button>
                </div>
            </div>
        </div>

        <!-- 筹款平台页面 -->
        <div id="fundpad" class="page">
            <div class="card">
                <h2>筹款平台</h2>
                <button class="btn" onclick="openCreateProjectModal()">创建新项目</button>
                <button class="btn" onclick="loadProjects()">刷新项目列表</button>
            </div>

            <div id="projects-container">
                <div class="projects-grid" id="projects-list">
                    <!-- 项目列表将在这里动态加载 -->
                </div>
            </div>
        </div>

        <!-- DEX页面 -->
        <div id="dex" class="page">
            <div class="card">
                <h2>隐私DEX交易</h2>
                <p>在这里进行隐私保护的代币交易</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h3>存入资金</h3>
                        <div class="input-group">
                            <label>存入ETH数量:</label>
                            <input type="number" id="deposit-amount" placeholder="0.1" step="0.01">
                        </div>
                        <button class="btn" onclick="depositETH()">存入ETH</button>
                    </div>
                    
                    <div>
                        <h3>交易</h3>
                        <div class="input-group">
                            <label>卖出代币:</label>
                            <select id="token-in">
                                <option value="0x0000000000000000000000000000000000000000">ETH</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>买入代币:</label>
                            <select id="token-out">
                                <option value="0x0000000000000000000000000000000000000000">ETH</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>卖出数量:</label>
                            <input type="number" id="trade-amount-in" placeholder="0.1" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>期望买入数量:</label>
                            <input type="number" id="trade-amount-out" placeholder="0.1" step="0.01">
                        </div>
                        <button class="btn" onclick="createTradeOrder()">创建交易订单</button>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h3>我的订单</h3>
                    <div id="user-orders">
                        <!-- 用户订单将在这里显示 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建项目模态框 -->
    <div id="create-project-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateProjectModal()">&times;</span>
            <h2>创建新项目</h2>
            <form id="create-project-form">
                <div class="input-group">
                    <label>项目名称:</label>
                    <input type="text" id="project-name" required>
                </div>
                <div class="input-group">
                    <label>项目描述:</label>
                    <textarea id="project-description" rows="4" required></textarea>
                </div>
                <div class="input-group">
                    <label>目标金额 (ETH):</label>
                    <input type="number" id="project-target" step="0.01" required>
                </div>
                <div class="input-group">
                    <label>筹款期限 (天):</label>
                    <input type="number" id="project-duration" min="1" required>
                </div>
                <button type="submit" class="btn">创建项目</button>
            </form>
            <div id="create-project-status"></div>
        </div>
    </div>

    <!-- 项目详情模态框 -->
    <div id="project-detail-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProjectDetailModal()">&times;</span>
            <div id="project-detail-content">
                <!-- 项目详情内容 -->
            </div>
        </div>
    </div>

    <script>
        // 智能合约配置
        const FUNDPAD_CONTRACT_ADDRESS = "0x4B4A5F9a4d4c4e4f4A5f4A5f4A5f4A5f4A5f4A5f"; // 替换为实际地址
        const DEX_CONTRACT_ADDRESS = "0x5C5B6F5a5d5c5e5f5B5f5B5f5B5f5B5f5B5f5B5f"; // 替换为实际地址
        
        // FHEVM配置
        const FHEVM_CONFIG = {
            executor: "0x848B0066793BcC60346Da1F49049357399B8D595",
            acl: "0x687820221192C5B662b25367F70076A37bc79b6c",
            kmsVerifier: "0x1364cBBf2cDF5032C47d8226a6f6FBD2AFCDacAC",
            inputVerifier: "0xbc91f3daD1A5F19F8390c400196e58073B6a0BC4",
            decryptionOracle: "0xa02Cda4Ca3a71D7C46997716F4283aa851C28812"
        };

        // 全局变量
        let provider = null;
        let signer = null;
        let userAccount = null;
        let fundpadContract = null;
        let dexContract = null;

        // 智能合约ABI (简化版)
        const FUNDPAD_ABI = [
            "function createProject(string memory _name, string memory _description, uint256 _targetAmount, uint256 _duration) external returns (uint256)",
            "function contribute(uint256 _projectId, bytes memory _encryptedAmount, bytes memory _inputProof) external payable",
            "function getProject(uint256 _projectId) external view returns (tuple(uint256 id, address creator, string name, string description, uint256 targetAmount, uint256 deadline, uint256 encryptedRaised, uint64 decryptedRaised, bool isActive, bool isDecrypted, uint8 status))",
            "function getAllActiveProjects() external view returns (uint256[] memory)",
            "function totalProjects() external view returns (uint256)",
            "event ProjectCreated(uint256 indexed projectId, address indexed creator, string name, uint256 targetAmount, uint256 deadline)",
            "event ContributionMade(uint256 indexed projectId, address indexed contributor, uint256 amount)"
        ];

        const DEX_ABI = [
            "function depositETH(bytes memory _encryptedAmount, bytes memory _inputProof) external payable",
            "function createOrder(address _tokenIn, address _tokenOut, bytes memory _encryptedAmountIn, bytes memory _encryptedAmountOut, bytes memory _inputProofIn, bytes memory _inputProofOut, uint8 _orderType) external returns (uint256)",
            "function getUserOrders(address _user) external view returns (uint256[] memory)",
            "function getOrder(uint256 _orderId) external view returns (tuple(uint256 id, address trader, address tokenIn, address tokenOut, uint256 encryptedAmountIn, uint256 encryptedAmountOut, uint64 decryptedAmountIn, uint64 decryptedAmountOut, bool isActive, bool isDecrypted, uint8 orderType, uint8 status))",
            "event OrderCreated(uint256 indexed orderId, address indexed trader, uint8 orderType)"
        ];

        // 初始化
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                console.log('MetaMask is installed!');
                await checkConnection();
            } else {
                console.log('MetaMask is not installed');
                document.getElementById('wallet-status').textContent = 'Please install MetaMask';
            }
        });

        // 检查钱包连接状态
        async function checkConnection() {
            try {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                const accounts = await provider.listAccounts();
                
                if (accounts.length > 0) {
                    await connectWallet();
                }
            } catch (error) {
                console.error('Error checking connection:', error);
            }
        }

        // 连接钱包
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    alert('请安装MetaMask钱包');
                    return;
                }

                // 请求连接
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAccount = await signer.getAddress();
                
                // 初始化合约实例
                fundpadContract = new ethers.Contract(FUNDPAD_CONTRACT_ADDRESS, FUNDPAD_ABI, signer);
                dexContract = new ethers.Contract(DEX_CONTRACT_ADDRESS, DEX_ABI, signer);
                
                await updateWalletDisplay();
                
                // 监听账户变化
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', handleChainChanged);
                
            } catch (error) {
                console.error('连接钱包失败:', error);
                alert('连接钱包失败: ' + error.message);
            }
        }

        // 更新钱包显示
        async function updateWalletDisplay() {
            try {
                const balance = await provider.getBalance(userAccount);
                const network = await provider.getNetwork();
                
                document.getElementById('wallet-status').textContent = '钱包已连接';
                document.getElementById('wallet-address').textContent = 
                    userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                document.getElementById('wallet-balance').textContent = 
                    ethers.utils.formatEther(balance).substring(0, 6);
                document.getElementById('network-info').textContent = 
                    network.name + ' (Chain ID: ' + network.chainId + ')';
                
                document.getElementById('wallet-info').style.display = 'block';
                document.getElementById('connect-wallet').textContent = '断开连接';
                document.getElementById('connect-wallet').onclick = disconnectWallet;
                
            } catch (error) {
                console.error('更新钱包显示失败:', error);
            }
        }

        // 断开钱包连接
        function disconnectWallet() {
            provider = null;
            signer = null;
            userAccount = null;
            fundpadContract = null;
            dexContract = null;
            
            document.getElementById('wallet-status').textContent = '未连接钱包';
            document.getElementById('wallet-info').style.display = 'none';
            document.getElementById('connect-wallet').textContent = '连接MetaMask';
            document.getElementById('connect-wallet').onclick = connectWallet;
        }

        // 处理账户变化
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else {
                connectWallet();
            }
        }

        // 处理网络变化
        function handleChainChanged(chainId) {
            window.location.reload();
        }

        // 页面导航
        function showPage(pageId) {
            // 隐藏所有页面
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // 移除所有导航按钮的active类
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(btn => btn.classList.remove('active'));
            
            // 显示目标页面
            document.getElementById(pageId).classList.add('active');
            
            // 激活对应的导航按钮
            event.target.classList.add('active');
            
            // 如果是筹款页面，加载项目
            if (pageId === 'fundpad') {
                loadProjects();
            } else if (pageId === 'dex') {
                loadUserOrders();
            }
        }

        // 模态框控制
        function openCreateProjectModal() {
            if (!userAccount) {
                alert('请先连接钱包');
                return;
            }
            document.getElementById('create-project-modal').style.display = 'block';
        }

        function closeCreateProjectModal() {
            document.getElementById('create-project-modal').style.display = 'none';
            document.getElementById('create-project-form').reset();
            document.getElementById('create-project-status').innerHTML = '';
        }

        function closeProjectDetailModal() {
            document.getElementById('project-detail-modal').style.display = 'none';
        }

        // 创建项目
        async function createProject(event) {
            event.preventDefault();
            
            if (!fundpadContract) {
                alert('请先连接钱包');
                return;
            }

            const statusDiv = document.getElementById('create-project-status');
            statusDiv.innerHTML = '<div style="color: yellow;">正在创建项目...</div>';

            try {
                const name = document.getElementById('project-name').value;
                const description = document.getElementById('project-description').value;
                const targetAmount = ethers.utils.parseEther(document.getElementById('project-target').value);
                const duration = parseInt(document.getElementById('project-duration').value) * 24 * 60 * 60; // 转换为秒

                // 调用智能合约创建项目
                const tx = await fundpadContract.createProject(name, description, targetAmount, duration);
                
                statusDiv.innerHTML = '<div style="color: yellow;">交易已提交，等待确认...</div>';
                
                const receipt = await tx.wait();
                
                statusDiv.innerHTML = '<div class="success">项目创建成功！</div>';
                
                // 关闭模态框并刷新项目列表
                setTimeout(() => {
                    closeCreateProjectModal();
                    loadProjects();
                }, 2000);
                
            } catch (error) {
                console.error('创建项目失败:', error);
                statusDiv.innerHTML = '<div class="error">创建项目失败: ' + error.message + '</div>';
            }
        }

        // 加载项目列表
        async function loadProjects() {
            if (!fundpadContract) {
                document.getElementById('projects-list').innerHTML = '<p>请先连接钱包</p>';
                return;
            }

            try {
                const projectIds = await fundpadContract.getAllActiveProjects();
                const projectsContainer = document.getElementById('projects-list');
                
                if (projectIds.length === 0) {
                    projectsContainer.innerHTML = '<p>暂无活跃项目</p>';
                    return;
                }

                let projectsHTML = '';
                
                for (let id of projectIds) {
                    try {
                        const project = await fundpadContract.getProject(id);
                        const deadline = new Date(project.deadline * 1000);
                        const isExpired = Date.now() > deadline.getTime();
                        
                        projectsHTML += `
                            <div class="project-card">
                                <h3>${project.name}</h3>
                                <p>${project.description}</p>
                                <div style="margin: 15px 0;">
                                    <div>目标: ${ethers.utils.formatEther(project.targetAmount)} ETH</div>
                                    <div>创建者: ${project.creator.substring(0, 6)}...${project.creator.substring(38)}</div>
                                    <div>截止时间: ${deadline.toLocaleDateString()}</div>
                                    <div>状态: <span class="status-indicator ${project.isActive ? 'status-active' : 'status-completed'}">${project.isActive ? '进行中' : '已结束'}</span></div>
                                </div>
                                ${project.isActive && !isExpired ? `
                                    <div style="margin-top: 15px;">
                                        <input type="number" id="contribute-${id}" placeholder="投资金额(ETH)" step="0.01" style="margin-bottom: 10px;">
                                        <button class="btn" onclick="contributeToProject(${id})">投资项目</button>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    } catch (error) {
                        console.error(`Error loading project ${id}:`, error);
                    }
                }
                
                projectsContainer.innerHTML = projectsHTML;
                
            } catch (error) {
                console.error('加载项目列表失败:', error);
                document.getElementById('projects-list').innerHTML = '<p>加载项目失败</p>';
            }
        }

        // 投资项目
        async function contributeToProject(projectId) {
            if (!fundpadContract) {
                alert('请先连接钱包');
                return;
            }

            const amountInput = document.getElementById(`contribute-${projectId}`);
            const amount = amountInput.value;
            
            if (!amount || parseFloat(amount) <= 0) {
                alert('请输入有效的投资金额');
                return;
            }

            try {
                const weiAmount = ethers.utils.parseEther(amount);
                
                // 这里需要实现FHE加密逻辑
                // 为了演示，我们使用简化的方式
                const encryptedAmount = "0x" + "0".repeat(64); // 简化的加密数据
                const inputProof = "0x" + "0".repeat(128); // 简化的证明数据
                
                const tx = await fundpadContract.contribute(
                    projectId,
                    encryptedAmount,
                    inputProof,
                    { value: weiAmount }
                );
                
                alert('交易已提交，请等待确认...');
                
                const receipt = await tx.wait();
                
                alert('投资成功！');
                amountInput.value = '';
                loadProjects(); // 刷新项目列表
                
            } catch (error) {
                console.error('投资失败:', error);
                alert('投资失败: ' + error.message);
            }
        }

        // DEX功能
        async function depositETH() {
            if (!dexContract) {
                alert('请先连接钱包');
                return;
            }

            const amount = document.getElementById('deposit-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert('请输入有效的金额');
                return;
            }

            try {
                const weiAmount = ethers.utils.parseEther(amount);
                
                // 简化的加密数据
                const encryptedAmount = "0x" + "0".repeat(64);
                const inputProof = "0x" + "0".repeat(128);
                
                const tx = await dexContract.depositETH(encryptedAmount, inputProof, {
                    value: weiAmount
                });
                
                alert('交易已提交，请等待确认...');
                const receipt = await tx.wait();
                alert('存入成功！');
                
                document.getElementById('deposit-amount').value = '';
                
            } catch (error) {
                console.error('存入失败:', error);
                alert('存入失败: ' + error.message);
            }
        }

        async function createTradeOrder() {
            if (!dexContract) {
                alert('请先连接钱包');
                return;
            }

            const tokenIn = document.getElementById('token-in').value;
            const tokenOut = document.getElementById('token-out').value;
            const amountIn = document.getElementById('trade-amount-in').value;
            const amountOut = document.getElementById('trade-amount-out').value;

            if (!amountIn || !amountOut || parseFloat(amountIn) <= 0 || parseFloat(amountOut) <= 0) {
                alert('请输入有效的交易金额');
                return;
            }

            try {
                // 简化的加密数据
                const encryptedAmountIn = "0x" + "0".repeat(64);
                const encryptedAmountOut = "0x" + "0".repeat(64);
                const inputProofIn = "0x" + "0".repeat(128);
                const inputProofOut = "0x" + "0".repeat(128);
                
                const tx = await dexContract.createOrder(
                    tokenIn,
                    tokenOut,
                    encryptedAmountIn,
                    encryptedAmountOut,
                    inputProofIn,
                    inputProofOut,
                    0 // OrderType.Buy
                );
                
                alert('交易订单已提交，请等待确认...');
                const receipt = await tx.wait();
                alert('订单创建成功！');
                
                // 清空输入
                document.getElementById('trade-amount-in').value = '';
                document.getElementById('trade-amount-out').value = '';
                
                loadUserOrders();
                
            } catch (error) {
                console.error('创建订单失败:', error);
                alert('创建订单失败: ' + error.message);
            }
        }

        async function loadUserOrders() {
            if (!dexContract || !userAccount) {
                document.getElementById('user-orders').innerHTML = '<p>请先连接钱包</p>';
                return;
            }

            try {
                const orderIds = await dexContract.getUserOrders(userAccount);
                const ordersContainer = document.getElementById('user-orders');
                
                if (orderIds.length === 0) {
                    ordersContainer.innerHTML = '<p>暂无订单</p>';
                    return;
                }

                let ordersHTML = '<h4>我的交易订单:</h4>';
                
                for (let id of orderIds) {
                    try {
                        const order = await dexContract.getOrder(id);
                        ordersHTML += `
                            <div class="trading-pair">
                                <div>订单ID: ${id}</div>
                                <div>类型: ${order.orderType === 0 ? '买入' : '卖出'}</div>
                                <div>状态: ${order.isActive ? '活跃' : '已完成'}</div>
                            </div>
                        `;
                    } catch (error) {
                        console.error(`Error loading order ${id}:`, error);
                    }
                }
                
                ordersContainer.innerHTML = ordersHTML;
                
            } catch (error) {
                console.error('加载订单失败:', error);
                document.getElementById('user-orders').innerHTML = '<p>加载订单失败</p>';
            }
        }

        // 绑定表单提交事件
        document.getElementById('create-project-form').addEventListener('submit', createProject);
        document.getElementById('connect-wallet').addEventListener('click', connectWallet);

        // 点击模态框外部关闭
        window.onclick = function(event) {
            const createModal = document.getElementById('create-project-modal');
            const detailModal = document.getElementById('project-detail-modal');
            
            if (event.target == createModal) {
                closeCreateProjectModal();
            }
            if (event.target == detailModal) {
                closeProjectDetailModal();
            }
        }
    </script>
</body>
</html>